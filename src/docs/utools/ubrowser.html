<h1 id="ubrowser-api"><a href="#ubrowser-api" aria-hidden="true" class="header-anchor">#</a> ubrowser API</h1> <p>uTools browser 简称 ubrowser，是根据 uTools 的特性，量身打造的一个可编程浏览器。</p> <p>这是令我们感到特别兴奋一组API，因为利用 ubrowser 你可以轻而易举连接一切互联网服务，而且可以与uTools完美结合。</p> <p>ubrowser 拥有优雅的链式调用接口，你可以用口语化的数行代码，实现一系列匪夷所思的操作。例如：</p> <p>1、自动化测试（自动打开页面、点击、判断，彻底解放测试人员。）</p> <p>2、自动抢票</p> <p>3、自动去除搜索引擎广告</p> <p>4、自动将选中的文字、图片保存到各类云笔记</p> <p>基本demo：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 打开"必应" 并搜索 "uTools"</span>
    utools<span class="token punctuation">.</span>ubrowser<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'https://cn.bing.com'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token string">'#sb_form_q'</span><span class="token punctuation">,</span> <span class="token string">'uTools'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token string">'#sb_form_go'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">{</span> width<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">600</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    </code></pre></div><h3 id="useragent-useragent"><a href="#useragent-useragent" aria-hidden="true" class="header-anchor">#</a> <code>useragent(userAgent)</code></h3> <ul><li><code>userAgent</code> String</li></ul> <blockquote><p>设置 User-Agent</p></blockquote> <h3 id="goto-url-headers"><a href="#goto-url-headers" aria-hidden="true" class="header-anchor">#</a> <code>goto(url, headers)</code></h3> <ul><li><p><code>url</code> String</p></li> <li><p><code>headers</code> Object (可选)</p> <blockquote><p>{ Referer: string, userAgent: string }</p></blockquote></li></ul> <blockquote><p>前往</p></blockquote> <h3 id="goto-mdtext-title"><a href="#goto-mdtext-title" aria-hidden="true" class="header-anchor">#</a> <code>goto(mdText, title)</code></h3> <ul><li><p><code>mdText</code> String</p> <blockquote><p>Markdown 文本</p></blockquote></li> <li><p><code>title</code> String (可选)</p> <blockquote><p>窗口标题</p></blockquote></li></ul> <blockquote><p>Markdown 转 Html 并显示</p></blockquote> <h3 id="viewport-width-height"><a href="#viewport-width-height" aria-hidden="true" class="header-anchor">#</a> <code>viewport(width, height)</code></h3> <ul><li><code>width</code> Integer</li> <li><code>height</code> Integer</li></ul> <blockquote><p>页面大小</p></blockquote> <h3 id="hide"><a href="#hide" aria-hidden="true" class="header-anchor">#</a> <code>hide()</code></h3> <blockquote><p>隐藏 ubrowser 窗口</p></blockquote> <h3 id="show"><a href="#show" aria-hidden="true" class="header-anchor">#</a> <code>show()</code></h3> <blockquote><p>显示 ubrowser 窗口</p></blockquote> <h3 id="css-csscode"><a href="#css-csscode" aria-hidden="true" class="header-anchor">#</a> <code>css(cssCode)</code></h3> <ul><li><code>cssCode</code> String</li></ul> <blockquote><p>注入样式</p></blockquote> <h3 id="press-key-modifier"><a href="#press-key-modifier" aria-hidden="true" class="header-anchor">#</a> <code>press(key, ...modifier)</code></h3> <ul><li><p><code>key</code> String</p></li> <li><p><code>modifier</code> String (可选)</p> <blockquote><p>control | ctrl | shift | meta | alt | command | cmd</p></blockquote></li></ul> <blockquote><p>键盘按键</p></blockquote> <h3 id="paste-text"><a href="#paste-text" aria-hidden="true" class="header-anchor">#</a> <code>paste(text)</code></h3> <ul><li><p><code>text</code> String (可选)</p> <blockquote><p>文本字符串 | 图片base64</p></blockquote></li></ul> <blockquote><p>执行粘贴</p></blockquote> <h3 id="screenshot-arg-savepath"><a href="#screenshot-arg-savepath" aria-hidden="true" class="header-anchor">#</a> <code>screenshot(arg, savePath)</code></h3> <ul><li><code>arg</code> String | Object (可选)</li></ul> <blockquote><p>String - 要截取的DOM元素</p></blockquote> <blockquote><p>Object - 截图位置和大小 { x: Integer, y: Integer, width: Integer, height: Integer }</p></blockquote> <blockquote><p>为空 截取整个窗口</p></blockquote> <ul><li><p><code>savePath</code> String (可选)</p> <blockquote><p>图片保存路径, 也可以是完整PNG文件路径。默认 存储在临时目录</p></blockquote></li></ul> <blockquote><p>部分网页截图</p></blockquote> <h3 id="pdf-options-savepath"><a href="#pdf-options-savepath" aria-hidden="true" class="header-anchor">#</a> <code>pdf(options, savePath)</code></h3> <ul><li><p><code>options</code> Object (可选)</p> <blockquote><p>{ marginsType: 0 | 1 | 2, pageSize: ('A3' | 'A4' | 'A5' | 'Legal' | 'Letter' | 'Tabloid') | { width: Integer, height: Integer } }</p> <p>与 <a href="https://www.electronjs.org/docs/api/web-contents#contentsprinttopdfoptions" target="_blank" rel="noopener noreferrer">Electron API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一致</p></blockquote></li> <li><p><code>savePath</code> String (可选)</p> <blockquote><p>图片保存路径, 也可以是完整pdf文件路径。默认 存储在临时目录</p></blockquote></li></ul> <blockquote><p>保存页面为PDF</p></blockquote> <h3 id="device-arg"><a href="#device-arg" aria-hidden="true" class="header-anchor">#</a> <code>device(arg)</code></h3> <ul><li><p><code>arg</code> String | Object</p> <blockquote><p>String - 'iPhone 11' | 'iPhone X' | 'iPad' | 'iPhone 6/7/8 Plus' | 'iPhone 6/7/8' | 'iPhone 5/SE' | 'HUAWEI Mate10' | 'HUAWEI Mate20' | 'HUAWEI Mate30' | 'HUAWEI Mate30 Pro'</p></blockquote> <blockquote><p>Object - { size: { width: Integer, height: Integer }, useragent: String }</p></blockquote></li></ul> <blockquote><p>模拟设备</p></blockquote> <h3 id="cookies-name"><a href="#cookies-name" aria-hidden="true" class="header-anchor">#</a> <code>cookies(name)</code></h3> <ul><li><code>name</code> String (可选)</li></ul> <blockquote><p>为空获取全部cookie
    获取cookie</p></blockquote> <h3 id="setcookies-name-value"><a href="#setcookies-name-value" aria-hidden="true" class="header-anchor">#</a> <code>setCookies(name, value)</code></h3> <ul><li><code>name</code> String</li> <li><code>value</code> String</li></ul> <blockquote><p>设置 cookie</p></blockquote> <h3 id="setcookies-cookies"><a href="#setcookies-cookies" aria-hidden="true" class="header-anchor">#</a> <code>setCookies(cookies)</code></h3> <ul><li><p><code>cookies</code> Array</p> <blockquote><p>[{ name: String, value: String }]</p></blockquote></li></ul> <blockquote><p>设置 cookie</p></blockquote> <h3 id="removecookies-name"><a href="#removecookies-name" aria-hidden="true" class="header-anchor">#</a> <code>removeCookies(name)</code></h3> <ul><li><code>name</code> String</li></ul> <blockquote><p>删除 cookie</p></blockquote> <h3 id="clearcookies-url"><a href="#clearcookies-url" aria-hidden="true" class="header-anchor">#</a> <code>clearCookies(url)</code></h3> <ul><li><p><code>url</code> String (可选)</p> <blockquote><p>在执行"goto"前执行 url参数必需</p></blockquote></li></ul> <blockquote><p>清空 cookie</p></blockquote> <h3 id="devtools-mode"><a href="#devtools-mode" aria-hidden="true" class="header-anchor">#</a> <code>devTools(mode)</code></h3> <ul><li><p><code>mode</code> String (可选)</p> <blockquote><p>'right' | 'bottom' | 'undocked' | 'detach' 默认为 'detach'</p></blockquote></li></ul> <blockquote><p>打开开发者工具</p></blockquote> <h3 id="evaluate-func-params"><a href="#evaluate-func-params" aria-hidden="true" class="header-anchor">#</a> <code>evaluate(func, ...params)</code></h3> <ul><li><p><code>func</code> Function</p> <blockquote><p>在网页内执行的函数</p></blockquote></li> <li><p><code>param</code> Any (可选)</p> <blockquote><p>传递给 func 的参数</p></blockquote></li></ul> <blockquote><p>执行JS函数 如果有返回值将加入到返回结果中</p></blockquote> <h4 id="示例"><a href="#示例" aria-hidden="true" class="header-anchor">#</a> 示例</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">(</span>param1<span class="token punctuation">,</span> param2<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'param1'</span><span class="token punctuation">,</span> <span class="token string">'param2'</span><span class="token punctuation">)</span>
    </code></pre></div><h3 id="wait-ms"><a href="#wait-ms" aria-hidden="true" class="header-anchor">#</a> <code>wait(ms)</code></h3> <ul><li><p><code>ms</code> Integer</p> <blockquote><p>等待的毫秒数</p></blockquote></li></ul> <blockquote><p>等待</p></blockquote> <h3 id="wait-selector-timeout"><a href="#wait-selector-timeout" aria-hidden="true" class="header-anchor">#</a> <code>wait(selector, timeout)</code></h3> <ul><li><p><code>selector</code> String</p> <blockquote><p>DOM元素</p></blockquote></li> <li><p><code>timeout</code> Integer (可选)</p> <blockquote><p>超时 默认 10000 ms</p></blockquote></li></ul> <blockquote><p>等待DOM元素出现</p></blockquote> <h3 id="wait-func-timeout，-params"><a href="#wait-func-timeout，-params" aria-hidden="true" class="header-anchor">#</a> <code>wait(func, timeout，...params)</code></h3> <ul><li><p><code>func</code> Function</p> <blockquote><p>在网页内执行的函数，返回 true 结束等待</p></blockquote></li> <li><p><code>timeout</code> Integer (可选)</p> <blockquote><p>超时 默认 10000 ms</p></blockquote></li> <li><p><code>param</code> Any (可选)</p> <blockquote><p>传递给 func 的参数</p></blockquote></li></ul> <blockquote><p>等待JS函数执行返回 true</p></blockquote> <h3 id="when-selector"><a href="#when-selector" aria-hidden="true" class="header-anchor">#</a> <code>when(selector)</code></h3> <ul><li><p><code>selector</code> String</p> <blockquote><p>DOM元素</p></blockquote></li></ul> <blockquote><p>当元素存在时执行直到碰到 end() 方法</p></blockquote> <h3 id="when-func-params"><a href="#when-func-params" aria-hidden="true" class="header-anchor">#</a> <code>when(func, ...params)</code></h3> <ul><li><p><code>func</code> Function</p> <blockquote><p>在网页内执行的函数，返回 true 执行</p></blockquote></li> <li><p><code>param</code> Any (可选)</p> <blockquote><p>传递给 func 的参数</p></blockquote></li></ul> <blockquote><p>当JS函数执行返回 true 时执行, 直到碰到 end() 方法</p></blockquote> <h3 id="end"><a href="#end" aria-hidden="true" class="header-anchor">#</a> <code>end()</code></h3> <blockquote><p>与 when 配套使用</p></blockquote> <h3 id="click-selector"><a href="#click-selector" aria-hidden="true" class="header-anchor">#</a> <code>click(selector)</code></h3> <ul><li><code>selector</code> String</li></ul> <blockquote><p>单击元素</p></blockquote> <h3 id="mousedown-selector"><a href="#mousedown-selector" aria-hidden="true" class="header-anchor">#</a> <code>mousedown(selector)</code></h3> <ul><li><code>selector</code> String</li></ul> <blockquote><p>元素触发按下鼠标左键</p></blockquote> <h3 id="mouseup-selector"><a href="#mouseup-selector" aria-hidden="true" class="header-anchor">#</a> <code>mouseup(selector)</code></h3> <ul><li><code>selector</code> String</li></ul> <blockquote><p>元素触发释放鼠标左键</p></blockquote> <h3 id="file-selector-payload"><a href="#file-selector-payload" aria-hidden="true" class="header-anchor">#</a> <code>file(selector, payload)</code></h3> <ul><li><p><code>selector</code> String</p> <blockquote><p>input type='file' 元素</p></blockquote></li> <li><p><code>payload</code> String | Array | Buffer</p> <blockquote><p>文件路径 或 路径集合 或 文件Buffer</p></blockquote></li></ul> <blockquote><p>为网页中的file input 赋值</p></blockquote> <h3 id="value-selector-val"><a href="#value-selector-val" aria-hidden="true" class="header-anchor">#</a> <code>value(selector, val)</code></h3> <ul><li><p><code>selector</code> String</p> <blockquote><p>input textarea select 元素</p></blockquote></li> <li><p><code>val</code> String</p></li></ul> <blockquote><p>为网页中的input textarea select 元素赋值</p></blockquote> <h3 id="check-selector-checked"><a href="#check-selector-checked" aria-hidden="true" class="header-anchor">#</a> <code>check(selector, checked)</code></h3> <ul><li><p><code>selector</code> String</p> <blockquote><p>checkbox radio 元素</p></blockquote></li> <li><p><code>checked</code> Boolean</p> <blockquote><p>是否选中</p></blockquote></li></ul> <blockquote><p>checkbox radio 元素选中或取消选中</p></blockquote> <h3 id="focus-selector"><a href="#focus-selector" aria-hidden="true" class="header-anchor">#</a> <code>focus(selector)</code></h3> <ul><li><code>selector</code> String</li></ul> <blockquote><p>元素获得焦点</p></blockquote> <h3 id="scroll-selector"><a href="#scroll-selector" aria-hidden="true" class="header-anchor">#</a> <code>scroll(selector)</code></h3> <ul><li><code>selector</code> String</li></ul> <blockquote><p>滚动到元素位置</p></blockquote> <h3 id="scroll-y"><a href="#scroll-y" aria-hidden="true" class="header-anchor">#</a> <code>scroll(y)</code></h3> <ul><li><code>y</code> Integer</li></ul> <blockquote><p>Y轴滚动</p></blockquote> <h3 id="scroll-x-y"><a href="#scroll-x-y" aria-hidden="true" class="header-anchor">#</a> <code>scroll(x, y)</code></h3> <ul><li><code>x</code> Integer</li> <li><code>y</code> Integer</li></ul> <blockquote><p>X轴和Y轴滚动</p></blockquote> <h3 id="run-ubrowserid"><a href="#run-ubrowserid" aria-hidden="true" class="header-anchor">#</a> <code>run(ubrowserId)</code></h3> <ul><li><p><code>ubrowserId</code> Integer</p> <blockquote><p>utools.getIdleUBrowsers() 中获得</p></blockquote></li> <li><p><code>返回</code> Promise</p></li></ul> <blockquote><p>运行在闲置的 ubrowser 上</p></blockquote> <h3 id="run-options"><a href="#run-options" aria-hidden="true" class="header-anchor">#</a> <code>run(options)</code></h3> <ul><li><p><code>options</code> Object</p> <ul><li><code>Object</code> <ul><li>show Boolean (可选) 是否显示</li> <li>width Integer (可选) 宽度 默认为800</li> <li>height Integer (可选) 高度 默认为600</li> <li>x Integer (可选) 位置X</li> <li>y Integer (可选) 位置Y</li> <li>center Boolean (可选) 窗口在屏幕居中</li> <li>minWidth Integer (可选) 窗口的最小宽度, 默认值为 0</li> <li>minHeight Integer (可选) 窗口的最小高度. 默认值为 0</li> <li>maxWidth Integer (可选) 窗口的最大宽度, 默认无限制</li> <li>maxHeight Integer (可选) 窗口的最大高度, 默认无限制</li> <li>resizable Boolean (可选) 窗口是否可以改变尺寸, 默认值为true</li> <li>movable Boolean (可选) 窗口是否可以移动. 在 Linux 中无效。 默认值为 true</li> <li>minimizable Boolean (可选) 窗口是否可以最小化. 在 Linux 中无效。 默认值为 true</li> <li>maximizable Boolean (可选) 窗口是否可以最大化动. 在 Linux 中无效。 默认值为 true</li> <li>alwaysOnTop Boolean (可选) 窗口是否永远置顶。 默认值为false</li> <li>fullscreen Boolean (可选) 窗口是否全屏. 默认值为false</li> <li>fullscreenable Boolean (可选) 窗口是否可以进入全屏状态，默认值为 true</li> <li>enableLargerThanScreen Boolean (可选) 是否允许改变窗口的大小使之大于屏幕的尺寸. 仅适用于 macOS，因为其它操作系统默认允许 大于屏幕的窗口。 默认值为 false</li> <li>opacity Number (可选) 设置窗口初始的不透明度, 介于 0.0 (完全透明) 和 1.0 (完全不透明) 之间。仅支持 Windows 和 macOS 。</li></ul></li></ul></li> <li><p><code>返回</code> Promise</p></li></ul> <blockquote><p>启动一个 ubrowser 运行</p></blockquote>